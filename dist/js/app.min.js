const artist=document.querySelector(".artist"),track=document.querySelector(".track"),timeRange=document.querySelector(".time__range"),startTime=document.querySelector(".start__time"),endTime=document.querySelector(".end__time"),body=document.querySelector("body"),songs=document.querySelector(".playlist"),bodyBg=document.querySelectorAll(".bg"),playlist=document.querySelector(".open");class AudioPlayer{constructor(e){this.player=document.querySelector(e),this.audio=document.querySelector(".audio"),this.light=document.getElementById("light"),playlist.onchange=function(e){songs.innerHTML="",count=0,player.audio.src="",document.querySelector(".player__open").style.display="none",player.playlistShow();for(let e=0;e<playlist.files.length;e++)songs.innerHTML+=`<li class="playlist-item"><p class="song__label">${playlist.files[e].name}</p></li>`;const t=document.querySelectorAll(".playlist-item");for(let e=0;e<t.length;e++)t[e].addEventListener("click",t=>{player.isPlay=!1,player.audio.src="",count=e,console.log(count),player.play()})},this.listeners()}listeners(){this.audio.addEventListener("click",this.play.bind(this)),this.audio.addEventListener("loadedmetadata",this.setTime.bind(this)),this.light.addEventListener("click",this.lightToggle.bind(this)),this.player.querySelector(".play").addEventListener("click",this.play.bind(this)),this.player.querySelector(".volume__range").addEventListener("input",this.volume.bind(this)),this.player.querySelector(".time__range").addEventListener("input",this.time.bind(this)),this.player.querySelector(".next").addEventListener("click",this.next.bind(this)),this.player.querySelector(".prev").addEventListener("click",this.prev.bind(this)),this.player.querySelector(".repeat").addEventListener("click",this.repeat.bind(this)),this.player.querySelector(".shuffle").addEventListener("click",this.shuffle.bind(this)),this.player.querySelector(".playlist__show").addEventListener("click",this.playlistShow.bind(this)),document.getElementById("min").addEventListener("click",this.mute.bind(this))}mute(){this.isMute=!this.isMute,this.audio.muted=this.isMute,document.getElementById("min").className=this.isMute?"fas fa-volume-mute":"fal fa-volume-down";const e=this.player.querySelector(".volume__range");this.isMute?(e.setAttribute("volume",e.value),e.value=0):e.value=e.getAttribute("volume")}lightToggle(){this.lightOn=!this.lightOn,this.lightOn?document.querySelector(".player").classList.add("player-shadow"):document.querySelector(".player").classList.remove("player-shadow"),player.light.className=this.lightOn?"fas fa-lightbulb":"fad fa-lightbulb",this.lightOn?player.light.setAttribute("id","light-on"):player.light.setAttribute("id","light")}play(){const e=document.querySelectorAll(".playlist-item");this.audio.currentTime<=0&&playlist.files.length>0&&(this.audio.src=URL.createObjectURL(playlist.files[count])),this.isPlay=!this.isPlay,this.isPlay&&playlist.files.length>0?(e.forEach(e=>{e.classList.remove("song-active")}),track.classList.add("track-run"),this.audio.play(),this.volume(),this.setTime(),e[count].classList.add("song-active"),track.innerHTML=playlist.files[count].name):(this.audio.pause(),track.classList.remove("track-run")),this.player.querySelector(".play .fal").className=this.isPlay?"fal fa-pause":"fal fa-play",this.audio.addEventListener("timeupdate",this.currentTime.bind(this))}volume(){const e=document.querySelector(".volume__range");this.audio.volume=e.value/100,this.audio.muted=!1,player.isMute=!1;this.player.querySelector(".mute .fas");document.getElementById("min").className=e.value<=0?"fas fa-volume-mute":"fal fa-volume-down"}time(){timeRange.max=this.audio.duration,this.audio.currentTime=timeRange.value}next(){track.classList.remove("track-run"),player.isPlay=!1,this.audio.pause(),this.audio.currentTime=0,player.shufflePlaylist&&playlist.files.length>2?count=getRandom(0,playlist.files.length,count):count<playlist.files.length-1?count++:count=0,this.play(),bgChange()}prev(){track.classList.remove("track-run"),this.audio.currentTime>this.audio.duration/10?(this.audio.currentTime=0,player.audio.play(),this.player.querySelector(".play .fal").className="fal fa-pause"):(player.isPlay=!1,this.audio.pause(),this.audio.currentTime=0,count>0?count--:count=playlist.files.length-1,console.log(playlist.files.length),this.play(),bgChange())}setTime(){const e=Math.floor(this.audio.duration);let t=Math.floor(e/60),l=Math.floor(e%60);t=t<10?`0${t}`:t,l=l<10?`0${l}`:l,endTime.innerHTML=`${t}:${l}`}currentTime(){const e=Math.floor(this.audio.currentTime),t=Math.floor(this.audio.duration);timeRange.max=t,timeRange.value=e;let l=Math.floor(e/60),i=Math.floor(e%60);l=l<10?`0${l}`:l,i=i<10?`0${i}`:i,startTime.innerHTML=`${l}:${i}`,e>=t&&count<playlist.files.length-1?player.repeat1Song?player.prev():player.next():e>=t&&count>=playlist.files.length-1&&(player.repeat1Song?player.prev():this.player.querySelector(".play .fal").className="fal fa-play",player.repeatPlaylist&&player.next())}repeat(){this.repeatPlaylist=!this.repeatPlaylist,player.repeat1Song?this.repeatPlaylist=!1:this.player.repeatPlaylist;const e=document.querySelector(".repeat .far");this.repeatPlaylist?e.style="color: #fff; text-shadow:0 0 2px #fff;filter:drop-shadow(0 0 2px #fff)":player.repeat1(),console.log(this.repeatPlaylist,player.repeat1Song)}repeat1(){this.repeat1Song=!this.repeat1Song;const e=document.querySelector(".repeat .far");this.repeat1Song?(e.className="far fa-repeat-1-alt",e.style="color: #fff; text-shadow:0 0 2px #fff;filter:drop-shadow(0 0 2px #fff)"):(e.className="far fa-repeat",e.style="text-shadow:none")}shuffle(){this.shufflePlaylist=!this.shufflePlaylist;const e=document.querySelector(".shuffle .far");this.shufflePlaylist?e.style="color: #fff; text-shadow:0 0 2px #fff;filter:drop-shadow(0 0 2px #fff)":e.style="text-shadow:none"}playlistShow(){this.playlistOn=!this.playlistOn,this.playlistOn?(document.querySelector(".album").style.height="0px",songs.style="height: 300px;border:1px solid #fff"):(document.querySelector(".album").style.height="300px",songs.style="height: 0; border:none")}}function bgChange(){body.style=`background: url("${bodyBg[getRandom(0,bodyBg.length)].src}") no-repeat; background-size: cover`}function getRandom(e,t,l){let i=Math.floor(Math.random()*(t-e))+e;return i===l?getRandom(e,t,l):i}let count=0;const player=new AudioPlayer(".player");